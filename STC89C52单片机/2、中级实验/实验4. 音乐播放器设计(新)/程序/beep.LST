C51 COMPILER V9.01   BEEP                                                                  11/21/2019 09:51:43 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE BEEP
OBJECT MODULE PLACED IN beep.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE beep.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2                  记住：三个数字一组，代表一个音符。
   3          第一个数字是1234567之一，代表音符哆来咪发...；
   4          第二个数字是0123之一，代表低音、中音、高音、超高音；
   5          第三个数字是半拍的个数，代表时间长度。
   6          
   7          
   8          */
   9          
  10          
  11          #include "reg52.h"                      //头文件调用
  12          sbit speaker = P2^5;                    //定义蜂鸣器
  13          
  14          unsigned char timer0h, timer0l; //音调高低
  15          unsigned char time;             //一个音符的时间
  16          //--------------------------------------
  17          //单片机晶振采用11.0592MHz
  18          // 频率-半周期数据表 高八位 本软件共保存了四个八度的28个频率数据
  19          code unsigned char FREQH[] = {
  20          0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8,           //低音1234567
  21          0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC, //1,2,3,4,5,6,7,i
  22          0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE,                     //高音 234567
  23          0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF};              //超高音 1234567
  24          
  25          // 频率-半周期数据表 低八位
  26          code unsigned char FREQL[] = {
  27          0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6,               //低音1234567
  28          0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, //1,2,3,4,5,6,7,i
  29          0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D,                     //高音 234567
  30          0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16};              //超高音 1234567
  31          //--------------------------------------
  32          //世上只有妈妈好数据表 要想演奏不同的乐曲, 只需要修改这个数据表
  33          code unsigned char sszymmh[] = {
  34          6, 2, 3, 5, 2, 1, 3, 2, 2, 5, 2, 2, 1, 3, 2, 6, 2, 1, 5, 2, 1, 
  35          //一个音符有三个数字。前为第几个音、中为第几个八度、后为时长（以半拍为单位）。
  36          //6, 2, 3 分别代表：６, 中音, ３个半拍;
  37          //5, 2, 1 分别代表：５, 中音, １个半拍;
  38          //3, 2, 2 分别代表：３, 中音, ２个半拍;
  39          //5, 2, 2 分别代表：５, 中音, ２个半拍;
  40          //1, 3, 2 分别代表：１, 高音, ２个半拍;
  41          //
  42          6, 2, 4, 3, 2, 2, 5, 2, 1, 6, 2, 1, 5, 2, 2, 3, 2, 2, 1, 2, 1,
  43          6, 1, 1, 5, 2, 1, 3, 2, 1, 2, 2, 4, 2, 2, 3, 3, 2, 1, 5, 2, 2,
  44          5, 2, 1, 6, 2, 1, 3, 2, 2, 2, 2, 2, 1, 2, 4, 5, 2, 3, 3, 2, 1,
  45          2, 2, 1, 1, 2, 1, 6, 1, 1, 1, 2, 1, 5, 1, 6, 0, 0, 0};
  46          
  47          
  48          
  49          //《烟花易冷》
  50          unsigned char code song1[]={
  51               5,2,1, 3,2,1, 2,2,2, 2,2,4, 3,2,1, 1,2,1, 2,2,1, 3,2,4, 
  52                   5,2,1, 3,2,1, 2,2,2, 2,2,2, 5,1,1, 3,2,1, 4,2,1, 3,2,4, 
  53                   3,2,1, 3,2,1, 7,2,1, 3,2,1, 2,2,2, 1,2,1, 7,1,1, 1,2,1, 
  54                   2,2,1, 3,2,1, 6,2,3, 6,1,1, 1,2,1, 3,2,1, 2,2,1, 6,1,1, 
  55                   1,2,1, 7,1,1, 5,1,1, 6,1,6, 5,2,1, 3,2,1, 2,2,2, 2,2,1, 
C51 COMPILER V9.01   BEEP                                                                  11/21/2019 09:51:43 PAGE 2   

  56                   2,2,1, 3,2,1, 1,2,1, 2,2,1, 3,2,4, 5,2,1, 3,2,1, 2,2,2, 
  57                   2,2,1, 2,2,1, 5,1,1, 3,2,1, 4,2,1, 3,2,4, 3,2,1, 3,2,1, 
  58                   7,2,3, 3,2,1, 2,2,2, 1,2,1, 7,1,1, 1,2,1, 2,2,1, 3,2,1, 
  59                   6,2,3, 6,1,1, 1,2,1, 3,2,1, 2,2,1, 6,1,1, 1,2,1, 7,1,2, 
  60                   5,1,2, 6,1,6, 0,0,0 };
  61          
  62          
  63          //--------------------------------------
  64          
  65          void t0int() interrupt 1        //T0中断程序，控制发音的音调
  66          {
  67   1              TR0 = 0;                                //先关闭T0
  68   1              speaker = !speaker;     //输出方波, 发音
  69   1              TH0 = timer0h;                  //下次的中断时间, 这个时间, 控制音调高低
  70   1              TL0 = timer0l;
  71   1              TR0 = 1;                                //启动T0
  72   1      }
  73          //--------------------------------------
  74          void delay(unsigned char t) //延时程序，控制发音的时间长度
  75          {
  76   1              unsigned char t1;
  77   1              unsigned long t2;
  78   1              for(t1 = 0; t1 < t; t1++) //双重循环, 共延时t个半拍
  79   1              for(t2 = 0; t2 < 8000; t2++); //延时期间, 可进入T0中断去发音
  80   1              TR0 = 0;                                                //关闭T0, 停止发音
  81   1      }
  82          //--------------------------------------
  83          void song() //演奏一个音符
  84                  {
  85   1              TH0 = timer0h; //控制音调
  86   1              TL0 = timer0l;
  87   1              TR0 = 1; //启动T0, 由T0输出方波去发音
  88   1              delay(time); //控制时间长度
  89   1              }
  90          //--------------------------------------
  91          void main(void)
  92          {
  93   1              unsigned char k, i;
  94   1              TMOD = 1; //置T0定时工作方式1
  95   1              ET0 = 1; //开T0中断
  96   1              EA = 1; //开CPU中断
  97   1              while(1) 
  98   1              {
  99   2                      i = 0;
 100   2                      time = 1; 
 101   2                      while(time) 
 102   2                      {
 103   3                              k = song1[i] + 7 * song1[i + 1] - 1;
 104   3                              //第i个是音符, 第i+1个是第几个八度
 105   3                              timer0h = FREQH[k]; //从数据表中读出频率数值
 106   3                              timer0l = FREQL[k]; //实际上, 是定时的时间长度
 107   3                              time = song1[i + 2]; //读出时间长度数值
 108   3                              i += 3;
 109   3                              song(); //发出一个音符
 110   3                      } 
 111   2              } 
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    169    ----
   CONSTANT SIZE    =    383    ----
C51 COMPILER V9.01   BEEP                                                                  11/21/2019 09:51:43 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
