C51 COMPILER V9.01   MAIN                                                                  11/21/2019 09:53:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**************************************************************************************
   2          *                             电子琴    
   3          接线说明*
   4                                  p2.7<-->蜂鸣器  
   5                                                          P0<-->数码管
   6                                                          P1<-->矩阵键盘
   7          * ************************************************************************************* */
   8          
   9          #include "reg52.h"                       //此文件中定义了单片机的一些特殊功能寄存器
  10          #include "key.h"
  11          
  12          #define u8 unsigned char          //对数据类型进行声明定义
  13          #define u16  unsigned int
  14          
  15          #define smg P0
  16          sbit led=P2^5;   //定义P20口是led
  17          sbit test1=P3^6;
  18          u16 Tab_F[]={   262,286,331,349,392,440,494,//低音
  19                                                                  523,587,659,698,784,880,988,//中音
  20                                                                  1046,1175,1318,1396,1568,1760,1975};//高音
  21          u8 code smgduan[17]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  22                                                  0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//显示0~F的值
  23          u8 key_num;
  24          u16 Freq,T_cnt;
  25                  
  26          bit beep; 
  27          /*******************************************************************************
  28          * 函 数 名         : Timer0Init
  29          * 函数功能                 : 定时器0初始化
  30          * 输    入         : 无
  31          * 输    出         : 无
  32          ***+****************************************************************************/
  33          void Timer0Init()
  34          {
  35   1              TMOD|=0X01;//选择为定时器0模式，工作方式1，仅用TR0打开启动。
  36   1      
  37   1              TH0=(65536-100)/256;    //给定时器赋初值，定时1ms
  38   1              TL0=(65536-100)%256;     
  39   1              ET0=1;//打开定时器0中断允许
  40   1              EA=1;//打开总中断
  41   1              TR0=1;//打开定时器                      
  42   1      }
  43          
  44          /*******************************************************************************
  45          * 函 数 名       : main
  46          * 函数功能               : 主函数
  47          * 输    入       : 无
  48          * 输    出       : 无
  49          *******************************************************************************/
  50          void main()
  51          {       
  52   1              Timer0Init();  //定时器0初始化
  53   1              while(1) 
  54   1              {
  55   2                      key_num=KeyDown();
C51 COMPILER V9.01   MAIN                                                                  11/21/2019 09:53:22 PAGE 2   

  56   2                      
  57   2                      if(key_num!=0xff)
  58   2                      {
  59   3                              
  60   3                              
  61   3                              P0=~smgduan[key_num];  //显示按键
  62   3                              Freq=Tab_F[key_num];   //发声
  63   3                       
  64   3                              beep=1;
  65   3                              T_cnt=0;
  66   3                              EA=1;
  67   3                      }
  68   2              };
  69   1              
  70   1      }
  71          
  72          
  73          /*******************************************************************************
  74          * 函 数 名         : void Timer0() interrupt 1
  75          * 函数功能                 : 定时器0中断函数
  76          * 输    入         : 无
  77          * 输    出         : 无  
  78          *******************************************************************************/
  79          void Timer0() interrupt 1
  80          {
  81   1              static u16 i;
  82   1              TH0=(65536-89)/256;     //给定时器赋初值，定时0.1ms
  83   1              TL0=(65536-89)%256;      
  84   1              i++;
  85   1              //test1=~test1;
  86   1              if(i>(5000/Freq))
  87   1              {
  88   2                      i=0;
  89   2              if(beep==1)
  90   2                      {led=~led;}     
  91   2              }       
  92   1              T_cnt++;
  93   1              if(T_cnt==1000)
  94   1                {
  95   2                              beep=0;
  96   2                              led=0;
  97   2                              EA=0;
  98   2                      }
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
