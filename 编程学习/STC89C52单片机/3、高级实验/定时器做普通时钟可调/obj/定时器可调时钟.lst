C51 COMPILER V9.01   ¶¨Ê±Æ÷¿Éµ÷Ê±_Ó                                                        03/03/2021 17:04:54 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE ¶¨Ê±Æ÷¿Éµ÷Ê±_Ó
OBJECT MODULE PLACED IN .\obj\¶¨Ê±Æ÷¿Éµ÷Ê±ÖÓ.obj
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE ¶¨Ê±Æ÷¿Éµ÷Ê±ÖÓ.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\¶¨Ê±Æ÷¿Éµ÷Ê±ÖÓ.lst)
                    - OBJECT(.\obj\¶¨Ê±Æ÷¿Éµ÷Ê±ÖÓ.obj)

line level    source

   1          /*-----------------------------------------------
   2               ÊµÑéÃû³Æ£º»ùÓÚ¶¨Ê±Æ÷T0µÄ¿Éµ÷Ê±ÖÓ¡¢
   3                           ½ÓÏßËµÃ÷£º
   4                                           LSA=>P2^2;
   5                                           LSB=>P2^3;
   6                                           LSC=>P2^4;
   7                                           P0=>ÊıÂë¹ÜÎ»Ñ¡
   8                                           P3=>¶ÀÁ¢°´¼ü
   9          ------------------------------------------------*/
  10          #include<reg52.h> //°üº¬Í·ÎÄ¼ş£¬Ò»°ãÇé¿ö²»ĞèÒª¸Ä¶¯£¬Í·ÎÄ¼ş°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  11          
  12          #define KeyPort P3 //¶¨Òå°´¼ü¶Ë¿Ú
  13          #define u8 unsigned char
  14          #define u16 unsigned int
  15          #define DataPort P0 //¶¨ÒåÊı¾İ¶Ë¿Ú ³ÌĞòÖĞÓöµ½DataPort ÔòÓÃP0 Ìæ»»
  16          
  17          //sbit LATCH1=P2^2;//¶¨ÒåËø´æÊ¹ÄÜ¶Ë¿Ú ¶ÎËø´æ
  18          //sbit LATCH2=P2^3;//                 Î»Ëø´æ
  19          sbit LSA=P2^2;
  20          sbit LSB=P2^3;
  21          sbit LSC=P2^4;
  22          
  23          sbit k1=P3^1;
  24          sbit k2=P3^0;
  25          sbit k3=P3^2;
  26          sbit k4=P3^3;
  27          
  28          unsigned char hour,minute,second;//¶¨ÒåÊ±·ÖÃë
  29          
  30          bit UpdateTimeFlag;//¶¨Òå¶ÁÊ±¼ä±êÖ¾
  31          
  32          unsigned char code dofly_DuanMa[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};// ÏÔÊ¾¶ÎÂëÖµ0~9
  33          unsigned char code dofly_WeiMa[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//·Ö±ğ¶ÔÓ¦ÏàÓ¦µÄÊıÂë¹ÜµãÁÁ,¼´Î»
             -Âë
  34          
  35          u8 code smgduan[17]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  36                                                  0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//ÏÔÊ¾0~FµÄÖµ
  37          
  38          unsigned char TempData[8],Key_Num; //´æ´¢ÏÔÊ¾ÖµµÄÈ«¾Ö±äÁ¿
  39          
  40          void DelayUs2x(unsigned char t);//us¼¶ÑÓÊ±º¯ÊıÉùÃ÷ 
  41          void DelayMs(unsigned char t); //ms¼¶ÑÓÊ±
  42          void DigDisplay();//ÊıÂë¹ÜÏÔÊ¾º¯Êı
  43          void KeyScan();//¼üÅÌÉ¨Ãè
  44          void     Init_Timer0(void);//¶¨Ê±Æ÷³õÊ¼»¯
  45          /*------------------------------------------------
  46                              Ö÷º¯Êı
  47          ------------------------------------------------*/
  48          void delay(u16 i)
  49          {
  50   1              while(i--);     
  51   1      }   
  52          /*--------------------------------------------------*/
  53          void main (void)
C51 COMPILER V9.01   ¶¨Ê±Æ÷¿Éµ÷Ê±_Ó                                                        03/03/2021 17:04:54 PAGE 2   

  54          {
  55   1      //unsigned char num;                  
  56   1      
  57   1      Init_Timer0();
  58   1      
  59   1      while (1)         //Ö÷Ñ­»·
  60   1        {
  61   2                                      KeyScan();      
  62   2                                              switch(Key_Num)
  63   2                                                      {
  64   3                                                                              case 1:hour++;if(hour==24)hour=0;Key_Num=0;     //Õı³£Ê±¼ä Ğ¡Ê± ¼Ó1
  65   3                                                                                               break;
  66   3                                                                              case 2:hour--;if(hour==255)hour=23;Key_Num=0;    //Õı³£Ê±¼ä Ğ¡Ê±¼õ1
  67   3                                                                                       break;
  68   3                                                                              case 3:minute++;if(minute==60)minute=0;Key_Num=0;      //·ÖÖÓ¼Ó1
  69   3                                                                                       break;
  70   3                                                                              case 4:minute--;if(minute==255)minute=59;Key_Num=0;    //·ÖÖÓ¼õ1
  71   3                                                                                       break;
  72   3                                                                              default:break;
  73   3                                                      } 
  74   2      //                                      if(UpdateTimeFlag==1)
  75   2      //                                       {
  76   2      //                                                              UpdateTimeFlag=0;
  77   2      
  78   2                                                               TempData[0]=dofly_DuanMa[hour/10]; //Ê±                        //Êı¾İµÄ×ª»»£¬ÒòÎÒÃÇ²ÉÓÃÊıÂë¹Ü0~9µÄÏÔÊ¾,½«Êı¾İ·Ö¿ª
  79   2                                                               TempData[1]=dofly_DuanMa[hour%10];
  80   2                                                               TempData[2]=0x40;                                                      //¼ÓÈë"-"
  81   2                                                               TempData[3]=dofly_DuanMa[minute/10];//·Ö
  82   2                                                               TempData[4]=dofly_DuanMa[minute%10];
  83   2                                                               TempData[5]=0x40;
  84   2                                                               TempData[6]=dofly_DuanMa[second/10];//Ãë
  85   2                                                               TempData[7]=dofly_DuanMa[second%10];   
  86   2                                                         
  87   2                                                              DigDisplay();
  88   2      //                                              }
  89   2                                              // DigDisplay();
  90   2       }
  91   1      }
  92          
  93          /*------------------------------------------------
  94           ÏÔÊ¾º¯Êı£¬ÓÃÓÚ¶¯Ì¬É¨ÃèÊıÂë¹Ü
  95           ÊäÈë²ÎÊı FirstBit ±íÊ¾ĞèÒªÏÔÊ¾µÄµÚÒ»Î»£¬Èç¸³Öµ2±íÊ¾´ÓµÚÈı¸öÊıÂë¹Ü¿ªÊ¼ÏÔÊ¾
  96           ÈçÊäÈë0±íÊ¾´ÓµÚÒ»¸öÏÔÊ¾¡£
  97           Num±íÊ¾ĞèÒªÏÔÊ¾µÄÎ»Êı£¬ÈçĞèÒªÏÔÊ¾99Á½Î»ÊıÖµÔò¸ÃÖµÊäÈë2
  98          ------------------------------------------------*/
  99          void DigDisplay()
 100          {
 101   1              u8 i=0;
 102   1              for(i=0;i<8;i++)
 103   1              {
 104   2                      switch(i)        //Î»Ñ¡£¬Ñ¡ÔñµãÁÁµÄÊıÂë¹Ü£¬
 105   2                      {
 106   3                              case(7):
 107   3                                      LSA=0;LSB=0;LSC=0; break;//ÏÔÊ¾µÚ0Î»
 108   3                              case(6):
 109   3                                      LSA=1;LSB=0;LSC=0; break;//ÏÔÊ¾µÚ1Î»
 110   3                              case(5):
 111   3                                      LSA=0;LSB=1;LSC=0; break;//ÏÔÊ¾µÚ2Î»
 112   3                              case(4):
 113   3                                      LSA=1;LSB=1;LSC=0; break;//ÏÔÊ¾µÚ3Î»
 114   3                              case(3):
 115   3                                      LSA=0;LSB=0;LSC=1; break;//ÏÔÊ¾µÚ4Î»
C51 COMPILER V9.01   ¶¨Ê±Æ÷¿Éµ÷Ê±_Ó                                                        03/03/2021 17:04:54 PAGE 3   

 116   3                              case(2):
 117   3                                      LSA=1;LSB=0;LSC=1; break;//ÏÔÊ¾µÚ5Î»
 118   3                              case(1):
 119   3                                      LSA=0;LSB=1;LSC=1; break;//ÏÔÊ¾µÚ6Î»
 120   3                              case(0):
 121   3                                      LSA=1;LSB=1;LSC=1; break;//ÏÔÊ¾µÚ7Î»    
 122   3                      }
 123   2                      P0=TempData[i];//·¢ËÍ¶ÎÂë
 124   2                      delay(100); //¼ä¸ôÒ»¶ÎÊ±¼äÉ¨Ãè  
 125   2                      P0=0x00;//ÏûÒş
 126   2              //delay(1000);
 127   2              }
 128   1      } 
 129          /*------------------------------------------------
 130                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌĞò
 131          ------------------------------------------------*/
 132          void Init_Timer0(void)
 133          {
 134   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì                 
 135   1       //TH0=0x00;          //¸ø¶¨³õÖµ
 136   1       //TL0=0x00;
 137   1       EA=1;            //×ÜÖĞ¶Ï´ò¿ª
 138   1       ET0=1;           //¶¨Ê±Æ÷ÖĞ¶Ï´ò¿ª
 139   1       TR0=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
 140   1      }
 141          /*------------------------------------------------
 142                           ¶¨Ê±Æ÷ÖĞ¶Ï×Ó³ÌĞò
 143          ------------------------------------------------*/
 144          void Timer0_isr(void) interrupt 1 
 145          {
 146   1       static unsigned int num,i;
 147   1       TH0=(65536-2000)/256;//ÖØĞÂ¸³Öµ 2ms
 148   1       TL0=(65536-2000)%256;
 149   1       
 150   1       // DigDisplay();     // µ÷ÓÃÊıÂë¹ÜÉ¨Ãè
 151   1      i++;
 152   1       if(i==10)                //20ms¸üĞÂÒ»´Î
 153   1          {
 154   2              i=0;
 155   2              UpdateTimeFlag=1;       //¸üĞÂÊ±¼äÖ¾Î»ÖÃ1
 156   2              }
 157   1       num++;
 158   1       if(num==500)        //´óÖÂ1s
 159   1         {
 160   2          num=0;
 161   2              second++;
 162   2              if(second==60)           //Ãëµ½60£¬·ÖÖÓ¼Ó1
 163   2               {
 164   3                second=0;       
 165   3                minute++;
 166   3                if(minute==60)        //·ÖÖÓµ½60£¬Ğ¡Ê±¼Ó1
 167   3                  {
 168   4                       minute=0;
 169   4                       hour++;
 170   4                       if(hour==24)           //Ğ¡Ê±µ½24£¬»ØÁã
 171   4                         hour=0;
 172   4                      }
 173   3               }
 174   2         
 175   2        }
 176   1      }
 177          
C51 COMPILER V9.01   ¶¨Ê±Æ÷¿Éµ÷Ê±_Ó                                                        03/03/2021 17:04:54 PAGE 4   

 178          /*------------------------------------------------
 179          °´¼üÉ¨Ãèº¯Êı£¬·µ»ØÉ¨Ãè¼üÖµ
 180          ----------------------------------------------*/
 181          void KeyScan()
 182          {
 183   1        if(k1==0)               //¼ì²â°´¼üK1ÊÇ·ñ°´ÏÂ
 184   1              {       
 185   2                      delay(1000);   //Ïû³ı¶¶¶¯ Ò»°ã´óÔ¼10ms
 186   2                      if(k1==0)        //ÔÙ´ÎÅĞ¶Ï°´¼üÊÇ·ñ°´ÏÂ
 187   2                      {
 188   3                              Key_Num=1;
 189   3                      }
 190   2                      while(!k1);      //¼ì²â°´¼üÊÇ·ñËÉ¿ª
 191   2              }
 192   1      
 193   1                      if(k2==0)                 //¼ì²â°´¼üK1ÊÇ·ñ°´ÏÂ
 194   1              {       
 195   2                      delay(1000);   //Ïû³ı¶¶¶¯ Ò»°ã´óÔ¼10ms
 196   2                      if(k2==0)        //ÔÙ´ÎÅĞ¶Ï°´¼üÊÇ·ñ°´ÏÂ
 197   2                      {
 198   3                              Key_Num=2;
 199   3                      }
 200   2                      while(!k2);      //¼ì²â°´¼üÊÇ·ñËÉ¿ª
 201   2              }
 202   1      
 203   1                      if(k3==0)                 //¼ì²â°´¼üK1ÊÇ·ñ°´ÏÂ
 204   1              {       
 205   2                      delay(1000);   //Ïû³ı¶¶¶¯ Ò»°ã´óÔ¼10ms
 206   2                      if(k3==0)        //ÔÙ´ÎÅĞ¶Ï°´¼üÊÇ·ñ°´ÏÂ
 207   2                      {
 208   3                              Key_Num=3;
 209   3                      }
 210   2                      while(!k3);      //¼ì²â°´¼üÊÇ·ñËÉ¿ª
 211   2              }
 212   1      
 213   1                      if(k4==0)                 //¼ì²â°´¼üK1ÊÇ·ñ°´ÏÂ
 214   1              {       
 215   2                      delay(1000);   //Ïû³ı¶¶¶¯ Ò»°ã´óÔ¼10ms
 216   2                      if(k4==0)        //ÔÙ´ÎÅĞ¶Ï°´¼üÊÇ·ñ°´ÏÂ
 217   2                      {
 218   3                              Key_Num=4;
 219   3                      }
 220   2                      while(!k4);      //¼ì²â°´¼üÊÇ·ñËÉ¿ª
 221   2              }                       
 222   1      }
 223          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    428    ----
   CONSTANT SIZE    =     35    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
